<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Globe Jour/Nuit avec Lune</title>
    <style>
        html, body {
            margin: 0;
            padding: 0;
            background: black;
            height: 100%;
            overflow: hidden;
        }
        #container {
            width: 100%;
            height: 100%;
        }
        #legend {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(255, 255, 255, 0.8);
            padding: 10px;
            border-radius: 8px;
            font-family: Arial, sans-serif;
            z-index: 1000;
        }
        .legend-item {
            display: flex;
            align-items: center;
            margin-bottom: 5px;
        }
        .legend-item label {
            margin-left: 5px;
            cursor: pointer;
        }
        #toggleMode {
            position: absolute;
            top: 10px;
            right: 10px;
            z-index: 1001;
            background: #222;
            border-radius: 20px;
            padding: 5px 15px;
            color: white;
            cursor: pointer;
            font-family: Arial, sans-serif;
            display: flex;
            align-items: center;
            gap: 5px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>
</head>
<body>
    <div id="container"></div>

    <!-- L√©gende -->
    <div id="legend">
        <div class="legend-item">
            <input type="checkbox" id="chkCountries">
            <label for="chkCountries">Limites des pays</label>
        </div>
        <div class="legend-item">
            <input type="checkbox" id="chkCapitals">
            <label for="chkCapitals">Capitales</label>
        </div>
        <div class="legend-item">
            <input type="checkbox" id="chkTrajets">
            <label for="chkTrajets">Trajets</label>
        </div>
    </div>

    <!-- Bouton Jour/Nuit -->
    <div id="toggleMode">‚òÄÔ∏è Jour</div>

    <script>
        const chart = echarts.init(document.getElementById('container'));
        let isNightMode = false;

        // Options initiales
        let option = {
            backgroundColor: 'black',
            globe: {
                baseTexture: 'earth.jpg',
                shading: 'lambert',
                light: {
                    ambient: { intensity: 0.4 },
                    main: { intensity: 0.8 }
                },
                viewControl: {
                    autoRotate: true,
                    autoRotateSpeed: 2,
                    targetCoord: [10, 50], // Europe au d√©marrage
                    minDistance: 80,
                    maxDistance: 500
                },
                layers: [
                    { type: 'blend', texture: 'starfield.jpg' }
                ]
            },
            series: []
        };

        chart.setOption(option);

        // Charger les GeoJSON
        const geoLayers = {
            countries: null,
            capitals: null,
            trajets: null
        };

        function loadGeoJSON(url, callback) {
            fetch(url)
                .then(r => r.json())
                .then(data => callback(data));
        }

        loadGeoJSON('countries_10m_new.geojson', data => {
            geoLayers.countries = {
                type: 'lines3D',
                coordinateSystem: 'globe',
                polyline: true,
                data: data.features.flatMap(f =>
                    f.geometry.coordinates.map(line => ({ coords: line.map(c => [c[0], c[1], 0]) }))
                ),
                lineStyle: { width: 1, color: 'white', opacity: 1 }
            };
        });

        loadGeoJSON('capitals.geojson', data => {
            geoLayers.capitals = {
                type: 'scatter3D',
                coordinateSystem: 'globe',
                symbolSize: 2,
                itemStyle: { color: 'red' },
                data: data.features.map(f => ({
                    value: [...f.geometry.coordinates, 0]
                }))
            };
        });

        loadGeoJSON('ALLLINE_TRAJET_wgs.geojson', data => {
            geoLayers.trajets = {
                type: 'lines3D',
                coordinateSystem: 'globe',
                polyline: true,
                data: data.features.flatMap(f =>
                    f.geometry.coordinates.map(line =>
                        ({ coords: line.map(c => [c[0], c[1], 0]) })
                    )
                ),
                lineStyle: { width: 2, color: 'yellow', opacity: 0.8 }
            };
        });

        // Gestion de la l√©gende
        function updateSeries() {
            let series = [];
            if (document.getElementById('chkCountries').checked) {
                series.push(geoLayers.countries);
                chart.setOption({
                    globe: { baseTexture: 'earth.jpg' }
                });
            }
            if (document.getElementById('chkCapitals').checked) {
                series.push(geoLayers.capitals);
            }
            if (document.getElementById('chkTrajets').checked) {
                series.push(geoLayers.trajets);
            }
            chart.setOption({ series });
        }

        document.querySelectorAll('#legend input').forEach(chk => {
            chk.addEventListener('change', updateSeries);
        });

        // Bouton Jour/Nuit
        document.getElementById('toggleMode').addEventListener('click', () => {
            isNightMode = !isNightMode;
            document.getElementById('toggleMode').textContent = isNightMode ? 'üåô Nuit' : '‚òÄÔ∏è Jour';
            chart.setOption({
                globe: {
                    baseTexture: isNightMode ? 'earth-night-yellow.jpg' : 'earth.jpg'
                }
            });
        });

        // Ajouter la lune
        option.series.push({
            type: 'globe',
            globe: {
                baseTexture: 'moon-base.jpg',
                heightTexture: 'moon-bump.jpg',
                shading: 'realistic',
                realisticMaterial: { roughness: 0.8 },
                viewControl: { distance: 150 },
                light: { ambient: { intensity: 0.4 }, main: { intensity: 0.8 } }
            }
        });

    </script>
</body>
</html>
