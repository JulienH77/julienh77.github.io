<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Globe interactif</title>
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      overflow: hidden;
      background: #000;
    }
    #globe {
      width: 100%;
      height: 100%;
    }
  </style>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5.5.0/dist/echarts.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/echarts-gl@2.0.9/dist/echarts-gl.min.js"></script>
</head>
<body>
<div id="globe"></div>

<script>
// === Initialisation du globe ===
var chart = echarts.init(document.getElementById('globe'));

// Textures du globe en base64 pour Ã©viter les blocages
var earthTexture = 'https://echarts.apache.org/examples/data-gl/asset/earth.jpg';
var earthBump = 'https://echarts.apache.org/examples/data-gl/asset/bathymetry_bw_composite_4k.jpg';

// Configuration initiale
var option = {
  backgroundColor: '#000',
  globe: {
    baseTexture: earthTexture,
    heightTexture: earthBump,
    shading: 'realistic',
    realisticMaterial: {
      roughness: 0.8,
      metalness: 0
    },
    light: {
      ambient: { intensity: 0.5 },
      main: { intensity: 0.5 }
    },
    viewControl: {
      autoRotate: false,
      targetCoord: [10, 50],
      minDistance: 50,
      maxDistance: 400
    }
  },
  series: [
    {
      type: 'scatter3D',
      coordinateSystem: 'globe',
      symbolSize: 10,
      itemStyle: { color: 'yellow' },
      data: [
        { name: 'Munich', value: [11.582, 48.135, 0] },
        { name: 'Salzbourg', value: [13.041, 47.809, 0] },
        { name: 'Budapest', value: [19.040, 47.497, 0] },
        { name: 'Prague', value: [14.437, 50.075, 0] },
        { name: 'Ratisbonne', value: [12.096, 49.019, 0] },
        { name: 'Ulm', value: [9.993, 48.401, 0] },
        { name: 'Vienne', value: [16.373, 48.208, 0] }
      ]
    }
  ]
};

chart.setOption(option);

// === Chargement des trajets ===
fetch('trajets.geojson')
  .then(res => res.json())
  .then(geojson => {
    const lignes = geojson.features.map(f => ({
      coords: f.geometry.coordinates.map(coord => [coord[0], coord[1], 0]),
      lineStyle: {
        color: f.properties.trajet || 'white'
      }
    }));

    chart.setOption({
      series: [
        option.series[0],
        {
          type: 'lines3D',
          coordinateSystem: 'globe',
          effect: {
            show: true,
            trailWidth: 2,
            trailLength: 0.1,
            trailOpacity: 0.8
          },
          lineStyle: { width: 2, opacity: 0.8 },
          data: lignes
        }
      ]
    });
  })
  .catch(err => console.error('Erreur chargement trajets.geojson:', err));
</script>
</body>
</html>
