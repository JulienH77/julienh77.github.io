<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Globe Jour/Nuit + Relief + Capitales</title>
<style>
  html, body { margin:0; padding:0; height:100%; background:#000; }
  #chart { width:100%; height:100%; }
  #toggleDayNight, #toggleRelief {
    position: absolute;
    left: 14px;
    width: 40px; height: 40px;
    border-radius: 50%;
    background: rgba(255,255,255,0.9);
    box-shadow: 0 4px 10px rgba(0,0,0,0.25);
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; user-select: none;
    transition: background 0.2s, transform 0.15s;
    z-index: 120;
  }
  #toggleDayNight { top: 14px; }
  #toggleRelief { top: 60px; }
  #toggleDayNight:active, #toggleRelief:active { transform: scale(0.95); }
  #dayTextureSelect {
    position: absolute;
    top: 110px; left: 14px;
    z-index: 120;
    background: rgba(255,255,255,0.9);
    padding: 4px;
    border-radius: 6px;
  }
</style>
<script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/echarts-gl@2/dist/echarts-gl.min.js"></script>
</head>
<body>
<div id="chart"></div>
<div id="toggleDayNight">☀️</div>
<div id="toggleRelief">⛰️</div>
<select id="dayTextureSelect">
  <option value="earth.jpg">Earth.jpg</option>
  <option value="world.topo.bathy.200401.jpg">Topo+Bathy</option>
</select>

<script>
const chart = echarts.init(document.getElementById('chart'));

// --- Variables d'état ---
let isNight = false;
let showRelief = false;
let dayTextureChoice = 'earth.jpg';

// --- Chemins vers textures ---
const PATH_EARTH_DAY = dayTextureChoice;
const PATH_EARTH_NIGHT = 'earth_night.jpg';
const PATH_EARTH_BUMP = 'earth_bump.jpg';
const PATH_STARFIELD = 'starfield.jpg';
const PATH_CLOUDS = 'clouds.png';

// --- Données capitales (exemple) ---
const capitalesData = [
  { city: 'Paris', coord: [2.3522, 48.8566] },
  { city: 'Shanghai', coord: [121.4737, 31.2304] },
  { city: 'New York', coord: [-74.006, 40.7128] }
];

// --- Fonction création option ---
function makeOption(s) {
  const layers = [];

  // Ombre nuit uniquement en mode jour
  if (!s.isNight) {
    layers.push({
      type: 'blend',
      blendTo: 'emission',
      texture: PATH_EARTH_NIGHT,
      intensity: 0.7
    });
  }

  // Nuages (toujours affichés ici)
  layers.push({
    type: 'overlay',
    texture: PATH_CLOUDS,
    shading: 'lambert',
    distance: 1.02
  });

  return {
    backgroundColor: '#000',
    globe: {
      baseTexture: s.isNight ? PATH_EARTH_NIGHT : s.dayTexture,
      heightTexture: s.showRelief ? PATH_EARTH_BUMP : undefined,
      displacementScale: 0.025,
      shading: s.isNight ? 'lambert' : 'realistic',
      environment: PATH_STARFIELD,
      postEffect: { enable : false },
      light: {
        ambient: {color: '#1f1f1f', intensity: 0.2},
        main: {color: '#FFFDED', intensity: 0.9}
      },
      atmosphere:{show:true, color: '#a1a1a1', offset:4},
      viewControl: { autoRotate: false, autoRotateSpeed:0.5 },
      layers
    },
    series: [
      {
        type: 'scatter3D',
        coordinateSystem: 'globe',
        symbol: 'rect',
        symbolSize: [6,6],
        itemStyle: {
          color: '#fff',
          borderColor: '#000',
          borderWidth: 1
        },
        label: {
          show: true,
          position: 'right',
          formatter: p => p.data.city,
          color: '#fff',
          backgroundColor: 'rgba(0,0,0,0.5)',
          borderRadius: 3,
          padding: 2
        },
        data: capitalesData.map(c => ({
          name: c.city,
          value: [...c.coord, 0],
          city: c.city
        }))
      }
    ]
  };
}

// --- Rendu initial ---
chart.setOption(makeOption({
  isNight,
  showRelief,
  dayTexture: dayTextureChoice
}));

// --- Bouton jour/nuit ---
document.getElementById('toggleDayNight').onclick = () => {
  isNight = !isNight;
  chart.setOption(makeOption({
    isNight,
    showRelief,
    dayTexture: dayTextureChoice
  }));
};

// --- Bouton relief ---
document.getElementById('toggleRelief').onclick = () => {
  showRelief = !showRelief;
  chart.setOption(makeOption({
    isNight,
    showRelief,
    dayTexture: dayTextureChoice
  }));
};

// --- Choix texture jour ---
document.getElementById('dayTextureSelect').onchange = e => {
  dayTextureChoice = e.target.value;
  chart.setOption(makeOption({
    isNight,
    showRelief,
    dayTexture: dayTextureChoice
  }));
};
</script>
</body>
</html>
