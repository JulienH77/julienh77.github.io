<!DOCTYPE html>
<html>
<head>
    <title>Globe avec trajets et nuages</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        #map { height: 100vh; }
        .legend { background: white; padding: 10px; line-height: 1.5em; }
        .layer-toggle { cursor: pointer; }
    </style>
</head>
<body>
    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // ==== Carte et fonds ====
        var map = L.map('map', {
            center: [20, 0],
            zoom: 2
        });

        var dayLayer = L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '© OpenStreetMap' }).addTo(map);
        var nightLayer = L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_night/{z}/{x}/{y}{r}.png', { attribution: '&copy; Stadia Maps' });
        var reliefLayer = L.tileLayer('https://tiles.stadiamaps.com/tiles/outdoors/{z}/{x}/{y}{r}.png', { attribution: '&copy; Stadia Maps' });

        // ==== Boutons jour/nuit/fonds ====
        var baseMaps = {
            "Jour": dayLayer,
            "Nuit": nightLayer,
            "Relief": reliefLayer
        };
        L.control.layers(baseMaps).addTo(map);

        // ==== Capitals (toujours visibles) ====
        var capitals = [
            {name: "Paris", coords: [48.8566, 2.3522]},
            {name: "Beijing", coords: [39.9042, 116.4074]},
            {name: "Washington", coords: [38.9072, -77.0369]}
        ];
        capitals.forEach(function(cap) {
            L.marker(cap.coords).addTo(map).bindPopup(cap.name);
        });

        // ==== Trajets ====
        var trajetsData = [
            {name: "Trajet A", coords: [[48.8566,2.3522],[39.9042,116.4074]]},
            {name: "Trajet B", coords: [[38.9072,-77.0369],[48.8566,2.3522]]}
        ];

        var trajetsLayers = {};
        trajetsData.forEach(function(trajet) {
            trajetsLayers[trajet.name] = L.polyline(trajet.coords, {color: 'red'}).addTo(map);
        });

        // ==== Légende dynamique pour trajets ====
        var legend = L.control({position: 'topright'});
        legend.onAdd = function(map){
            var div = L.DomUtil.create('div','legend');
            div.innerHTML = '<strong>Trajets</strong><br>';
            Object.keys(trajetsLayers).forEach(function(name){
                div.innerHTML += '<input type="checkbox" class="layer-toggle" checked data-layer="'+name+'"> '+name+'<br>';
            });
            return div;
        };
        legend.addTo(map);

        // Gestion des checkboxes
        document.querySelectorAll('.layer-toggle').forEach(function(input){
            input.addEventListener('change', function(){
                var layer = trajetsLayers[this.dataset.layer];
                if(this.checked) map.addLayer(layer);
                else map.removeLayer(layer);
            });
        });

        // ==== Nuages temps réel OpenWeatherMap ====
        var apiKey = 'TA_CLE_API_ICI'; // Mets ta clé ici
        var cloudsLayer = L.tileLayer(`https://tile.openweathermap.org/map/clouds_new/{z}/{x}/{y}.png?appid=${apiKey}`, {
            opacity: 0.5,
            attribution: '© OpenWeatherMap'
        }).addTo(map);

    </script>
</body>
</html>
