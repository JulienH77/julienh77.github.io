<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Globe interactif</title>
<style>
    body {
        margin: 0;
        background: url('starfield.jpg') repeat; /* Fond étoilé sur la page */
        background-size: cover;
        overflow: hidden;
        font-family: Arial, sans-serif;
    }
    #main {
        width: 100vw;
        height: 100vh;
    }
    /* Bouton jour/nuit */
    .toggle-btn {
        position: absolute;
        top: 10px;
        right: 10px;
        width: 60px;
        height: 30px;
        background: #ccc;
        border-radius: 15px;
        cursor: pointer;
        display: flex;
        align-items: center;
        padding: 3px;
    }
    .toggle-circle {
        width: 24px;
        height: 24px;
        background: yellow;
        border-radius: 50%;
        transition: transform 0.3s, background 0.3s;
    }
    .night .toggle-circle {
        transform: translateX(30px);
        background: #444;
    }
    /* Légende */
    .legend {
        position: absolute;
        top: 50px;
        left: 10px;
        background: rgba(255,255,255,0.8);
        padding: 10px;
        border-radius: 8px;
        font-size: 14px;
    }
    .legend label {
        display: block;
        cursor: pointer;
    }
</style>
<script src="echarts.min.js"></script>
<script src="echarts-gl.min.js"></script>
</head>
<body>

<div id="main"></div>

<!-- Bouton jour/nuit -->
<div class="toggle-btn" id="toggleBtn">
    <div class="toggle-circle"></div>
</div>

<!-- Légende -->
<div class="legend">
    <label><input type="checkbox" id="countries"> Limites des pays</label>
    <label><input type="checkbox" id="capitals"> Capitales</label>
    <label><input type="checkbox" id="trajets"> Trajets</label>
</div>

<script>
const chart = echarts.init(document.getElementById('main'));

let isNight = false;

// Textures
const earthTexture = 'earth_day_yourtexture.jpg';
const nightTexture = 'earth_night_yellow.jpg'; // version jaune
const moonTexture = 'moon-base.jpg';
const moonBump = 'moon-bump.jpg';

// Couleur de base du globe
let baseGlobeColor = '#000000';

// Série de données
let series = [];

// Fonction pour charger un GeoJSON
async function loadGeoJSON(url) {
    const res = await fetch(url);
    return await res.json();
}

// Ajout du globe Terre
function getGlobeOption() {
    return {
        globe: {
            baseTexture: isNight ? nightTexture : earthTexture,
            heightTexture: null,
            shading: 'lambert',
            light: {
                main: { intensity: 1.2 },
                ambient: { intensity: 0.3 }
            },
            viewControl: {
                autoRotate: true,
                autoRotateSpeed: 5, // vitesse réduite
                targetCoord: [10, 50], // Europe
                alpha: 30,
                beta: 160
            },
            environment: 'black',
            globeOuterRadius: 100,
            color: baseGlobeColor,
            layers: []
        },
        series
    };
}

// Lune
function getMoonSeries() {
    return {
        type: 'scatter3D',
        coordinateSystem: 'globe',
        symbol: 'circle',
        symbolSize: 1,
        itemStyle: { color: 'transparent' },
        label: { show: false },
        silent: true,
        renderItem: function(params, api) {
            return {
                type: 'mesh',
                shading: 'lambert',
                geometry: {
                    type: 'sphere',
                    widthSegments: 32,
                    heightSegments: 32
                },
                scale: [10, 10, 10], // lune plus petite
                position: [200, 0, 0],
                material: {
                    texture: moonTexture,
                    bumpTexture: moonBump,
                    bumpScale: 0.05
                },
                light: {
                    main: { intensity: 0.5 }
                }
            };
        }
    };
}

// Chargement initial
(async function(){
    // Pays
    const countriesGeo = await loadGeoJSON('countries_10m_new.geojson');
    series.push({
        name: 'Pays',
        type: 'map3D',
        map: 'world',
        data: [],
        lineStyle: { color: '#fff', width: 1 },
        silent: true,
        roam: true,
        show: false
    });
    echarts.registerMap('world', countriesGeo);

    // Capitales
    const capitalsGeo = await loadGeoJSON('capitals.geojson');
    series.push({
        name: 'Capitales',
        type: 'scatter3D',
        coordinateSystem: 'globe',
        symbol: 'circle',
        symbolSize: 2,
        itemStyle: { color: 'red' },
        data: capitalsGeo.features.map(f => ({
            value: f.geometry.coordinates.concat([0])
        })),
        show: false
    });

    // Trajets
    const trajetsGeo = await loadGeoJSON('ALLLINE_TRAJET_wgs.geojson');
    series.push({
        name: 'Trajets',
        type: 'lines3D',
        coordinateSystem: 'globe',
        blendMode: 'lighter',
        lineStyle: { width: 2, color: 'orange' },
        data: trajetsGeo.features.map(f => ({
            coords: f.geometry.coordinates
        })),
        show: false
    });

    // Lune
    series.push(getMoonSeries());

    chart.setOption(getGlobeOption());

    // Gestion légende
    document.getElementById('countries').addEventListener('change', function(){
        chart.setOption({
            series: series.map(s => s.name === 'Pays' ? {...s, show: this.checked} : s)
        });
    });
    document.getElementById('capitals').addEventListener('change', function(){
        chart.setOption({
            series: series.map(s => s.name === 'Capitales' ? {...s, show: this.checked} : s)
        });
    });
    document.getElementById('trajets').addEventListener('change', function(){
        chart.setOption({
            series: series.map(s => s.name === 'Trajets' ? {...s, show: this.checked} : s)
        });
    });

    // Bouton jour/nuit
    document.getElementById('toggleBtn').addEventListener('click', function(){
        isNight = !isNight;
        this.classList.toggle('night', isNight);
        chart.setOption(getGlobeOption());
    });
})();
</script>
</body>
</html>
